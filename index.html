<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SPOTYBOX by Alex</title>
<link rel="icon" type="image/png" href="docs/fav_icon.png">

<!-- libs -->
<script src="https://unpkg.com/jsmediatags@3.9.7/dist/jsmediatags.min.js"></script>
<script src="https://unpkg.com/browser-id3-writer@4.0.0/dist/browser-id3-writer.umd.js"></script>

<style>
/* ==============================
   ROOT + GLOBAL
============================== */
:root{
  --yellow:#ffd54a;
  --bg:#0b0b0b;
  --muted:#999;
}

body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:linear-gradient(135deg,#050505,#0e0e0e);
  color:#eee;
  padding:16px;
}

.container{
  max-width:1100px;
  margin:0 auto;
}

/* ==============================
   HEADER
============================== */
.header{
  display:flex;
  align-items:center;
  justify-content:center;
}

.led{
  background:#000;
  padding:6px 12px;
  border-radius:6px;
  color:var(--yellow);
  border:2px solid rgba(255,213,74,0.10);
  font-size:1.2rem;
  text-align:center;
}

/* ==============================
   COVER + INFO PANEL
============================== */
#cover-art{
  width:260px;
  height:260px;
  border-radius:8px;
  object-fit:cover;
  border:3px solid rgba(255,213,74,0.15);
  flex-shrink:0;
}

.cover-wrapper{
  position:relative;
}

#cover-loader{
  position:absolute;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,0.6);
  border-radius:8px;
}

.spinner{
  width:48px;height:48px;border-radius:50%;
  border:6px solid rgba(255,213,74,0.25);
  border-top-color:var(--yellow);
  animation:spin 1s linear infinite;
}
@keyframes spin { to{ transform:rotate(360deg); } }

/* ==============================
   BUTTONS + CONTROLS
============================== */
.controls{
  display:flex;
  gap:12px;
  align-items:center;
  flex-wrap:wrap;
}

.btn-yellow{
  background:var(--yellow);
  color:#000;
  border:none;
  padding:10px 16px;
  border-radius:999px;
  cursor:pointer;
  font-weight:bold;
}

.btn-icon{
  background:transparent;
  border:none;
  color:var(--yellow);
  font-size:26px;
  cursor:pointer;
}

/* ==============================
   SLIDERS
============================== */
.slider{
  width:140px;
}

@media(max-width:600px){
  .slider{ width:100px; }
}

/* ==============================
   CARDS + PLAYLIST
============================== */
.card{
  background:#0b0b0b;
  padding:14px;
  border-radius:10px;
  border:1px solid rgba(255,213,74,0.08);
}

.playlist-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:8px;
  margin-top:6px;
  background:rgba(255,255,255,0.03);
  border-radius:8px;
  font-size:0.95rem;
  flex-wrap:wrap;
}

.small{
  font-size:0.9rem;
  color:var(--muted);
}

a.link{
  color:var(--yellow);
}

/* ==============================
   EQ PANEL
============================== */
.eq-bars{
  display:flex;
  gap:6px;
  height:80px;
  align-items:flex-end;
  margin-top:8px;
}

.eq-bar{
  width:10px;
  background:linear-gradient(180deg,var(--yellow),#ffce3a);
  border-radius:6px;
  height:6px;
  transition:height .06s;
}

/* ==============================
   MODAL RESPONSIVE
============================== */
.modal{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,0.7);
  z-index:999;
  padding:20px;
}

.modal-card{
  background:#111;
  padding:16px;
  border-radius:10px;
  width:100%;
  max-width:420px;
  border:1px solid rgba(255,213,74,0.08);
}

/* ==============================
   RESPONSIVE LAYOUT MAIN
============================== */
.main-flex{
  display:flex;
  gap:20px;
  flex-wrap:wrap;
  margin-top:20px;
}

.main-info{
  flex:1;
  min-width:260px;
}

@media(max-width:768px){
  #cover-art{
    width:200px;
    height:200px;
  }
}

@media(max-width:560px){
  #cover-art{
    width:160px;
    height:160px;
  }

  .btn-yellow{
    padding:8px 12px;
    font-size:0.9rem;
  }

  .btn-icon{
    font-size:22px;
  }

  body{
    padding:10px;
  }

  .led{
    font-size:1rem;
    padding:6px 8px;
  }
}
</style>
</head>

<body>
<div class="container">

  <!-- HEADER -->
  <div class="header">
    <h1 class="led">SPOTYBOX by Alex</h1>
  </div>

  <!-- FLEX MAIN -->
  <div class="main-flex">

    <!-- COVER -->
    <div class="cover-wrapper">
      <img id="cover-art" src="https://placehold.co/600x600/0a0a0a/d4af37?text=‚ô™">
      <div id="cover-loader"><div class="spinner"></div></div>
    </div>

    <!-- INFO + CONTROLS -->
    <div class="main-info">
      <h2 id="track-title" class="small">Selecciona m√∫sica</h2>
      <p id="track-artist" class="small">---</p>
      <p id="track-album" class="small">---</p>

      <!-- LOAD + VOL -->
      <div class="controls" style="margin-top:8px">
        <label class="btn-yellow">üìÅ A√±adir MP3
          <input id="file-input" type="file" accept=".mp3" multiple hidden>
        </label>

        <button id="clear-playlist" class="btn-icon">üóëÔ∏è</button>

        <div style="flex:1"></div>

        <span class="small">Vol</span>
        <input id="volume-slider" type="range" min="0" max="100" value="80" class="slider">
        <span id="volume-display" class="small">80%</span>
      </div>

      <!-- PLAYER CONTROLS -->
      <div class="controls" style="margin-top:12px">
        <button id="prev-btn" class="btn-icon">‚èÆÔ∏è</button>
        <button id="play-btn" class="btn-yellow" style="width:64px;height:64px;">‚ñ∂</button>
        <button id="next-btn" class="btn-icon">‚è≠Ô∏è</button>
        <button id="shuffle-btn" class="btn-icon">üîÄ</button>
        <button id="repeat-btn" class="btn-icon">üîÅ</button>
      </div>

      <!-- EXTRAS -->
      <div class="controls" style="margin-top:10px">
        <button id="spotify-info" class="btn-yellow">üîé Spotify</button>
        <button id="shazam-info" class="btn-yellow">üéµ Info</button>
        <button id="toggle-eq" class="btn-icon">üéöÔ∏è</button>
        <button id="edit-tags" class="btn-icon">‚úèÔ∏è</button>
      </div>

      <!-- PROGRESS -->
      <div style="margin-top:10px">
        <input id="progress" type="range" min="0" max="100" value="0" style="width:100%;">
        <div style="display:flex;justify-content:space-between;margin-top:6px;">
          <span id="current-time" class="small">0:00</span>
          <span id="total-time" class="small">0:00</span>
        </div>
      </div>
    </div>

  </div>

  <!-- EQ PANEL -->
  <div id="eq-panel" class="card" style="display:none;margin-top:16px;">
    <div style="display:flex;justify-content:space-between;">
      <div class="small">Ecualizador ‚Äî 6 bandas</div>
      <div class="small">Bypass <input id="bypass-eq" type="checkbox"></div>
    </div>

    <div style="display:flex;gap:12px;margin-top:10px;flex-wrap:wrap;">
      <div><input class="slider eq-slider" data-freq="60" type="range" min="-12" max="12" value="0"><div class="small">60Hz</div></div>
      <div><input class="slider eq-slider" data-freq="170" type="range" min="-12" max="12" value="0"><div class="small">170Hz</div></div>
      <div><input class="slider eq-slider" data-freq="350" type="range" min="-12" max="12" value="0"><div class="small">350Hz</div></div>
      <div><input class="slider eq-slider" data-freq="1000" type="range" min="-12" max="12" value="0"><div class="small">1kHz</div></div>
      <div><input class="slider eq-slider" data-freq="3500" type="range" min="-12" max="12" value="0"><div class="small">3.5kHz</div></div>
      <div><input class="slider eq-slider" data-freq="10000" type="range" min="-12" max="12" value="0"><div class="small">10kHz</div></div>
    </div>

    <div class="eq-bars" id="eq-bars-visual" style="margin-top:10px;"></div>
  </div>

  <!-- PLAYLIST -->
  <div class="card" style="margin-top:18px;">
    <div style="display:flex;justify-content:space-between;">
      <strong>Playlist</strong>
      <span id="playlist-count" class="small">0</span>
    </div>
    <div id="playlist" style="margin-top:10px;"></div>
  </div>

</div>

<!-- MODAL -->
<div id="editor-modal" class="modal">
  <div class="modal-card">
    <h3>Editar ID3</h3>
    <input id="edit-title" placeholder="Title" style="width:100%;padding:8px;margin-top:8px;">
    <input id="edit-artist" placeholder="Artist" style="width:100%;padding:8px;margin-top:8px;">
    <input id="edit-album" placeholder="Album" style="width:100%;padding:8px;margin-top:8px;">
    <input id="edit-cover" type="file" accept="image/*" style="width:100%;margin-top:10px;">
    <div style="text-align:right;margin-top:10px;">
      <button id="save-tags" class="btn-yellow">Guardar</button>
      <button id="cancel-edit" class="btn-icon">Cancelar</button>
    </div>
  </div>
</div>

<script>
/* ===========================
   A ‚Äî FULL: core + features
   =========================== */
const audio = new Audio();
let audioCtx=null, analyser=null, freqData=null, srcNode=null;
const jukebox = {playlist:[], current:-1, isPlaying:false, coverCache: loadCoverCache(), eqNodes:[]};

function loadCoverCache(){ try{return JSON.parse(localStorage.getItem('coverCache_v1')||'{}')}catch(e){return{}} }
function saveCoverCache(){ try{localStorage.setItem('coverCache_v1', JSON.stringify(jukebox.coverCache))}catch(e){} }

function initAudioContext(){
  if(audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  srcNode = audioCtx.createMediaElementSource(audio);
  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 256;
  srcNode.connect(analyser);
  // build EQ chain
  const freqs = [60,170,350,1000,3500,10000];
  let prev = analyser;
  jukebox.eqNodes = freqs.map((f,i)=>{
    const b = audioCtx.createBiquadFilter(); b.type='peaking'; b.frequency.value=f; b.Q.value=1; b.gain.value=0;
    prev.connect(b); prev = b; return b;
  });
  if(jukebox.eqNodes.length) jukebox.eqNodes[jukebox.eqNodes.length-1].connect(audioCtx.destination);
  else analyser.connect(audioCtx.destination);
  freqData = new Uint8Array(analyser.frequencyBinCount);
  // init visual bars
  const visual = document.getElementById('eq-bars-visual');
  visual.innerHTML = ''; for(let i=0;i<28;i++){ const b = document.createElement('div'); b.className='eq-bar'; visual.appendChild(b); }
  animate();
}

function animate(){
  requestAnimationFrame(animate);
  if(!analyser) return;
  analyser.getByteFrequencyData(freqData);
  const bars = document.querySelectorAll('#eq-bars-visual .eq-bar');
  const step = Math.floor(freqData.length / bars.length) || 1;
  bars.forEach((b,i)=>{ const v = freqData[i*step]||0; b.style.height = (jukebox.isPlaying? (v/255)*80 : 5) + 'px'; });
}

/* Files + ID3 read */
document.getElementById('file-input').addEventListener('change', (e)=>{ const files=[...e.target.files].filter(f=>f.name.toLowerCase().endsWith('.mp3')); files.forEach(f=>jsmediatags.read(f,{onSuccess:tag=>addToPlaylist(f,tag),onError:()=>addToPlaylist(f,{tags:{}})})); e.target.value=''; });

function addToPlaylist(file, tag){
  const title = tag.tags.title || file.name.replace(/\.[^/.]+$/,'');
  const artist = tag.tags.artist || '';
  const album = tag.tags.album || '';
  const pic = tag.tags.picture ? blobFromTag(tag.tags.picture) : null;
  const url = URL.createObjectURL(file);
  const track = {id:crypto.randomUUID(), fileRef:file, url, title, artist, album, cover: pic};
  jukebox.playlist.push(track);
  renderPlaylist();
}

function blobFromTag(pic){
  const bytes = new Uint8Array(pic.data); return URL.createObjectURL(new Blob([bytes],{type:pic.format}));
}

function renderPlaylist(){
  const p = document.getElementById('playlist');
  p.innerHTML = '';
  jukebox.playlist.forEach((t,i)=>{
    const item = document.createElement('div'); item.className='playlist-item';
    const left = document.createElement('div'); left.textContent = t.title + (t.artist? ' ‚Äî '+t.artist : '');
    const right = document.createElement('div');
    const play = document.createElement('button'); play.textContent='‚ñ∂'; play.className='btn-icon'; play.onclick=()=>playTrack(i);
    const info = document.createElement('a'); info.textContent='Info'; info.href = '#'; info.className='link'; info.style.marginLeft='8px';
    info.onclick = (ev)=>{ ev.preventDefault(); window.open(`https://open.spotify.com/search/${encodeURIComponent(t.artist+' '+t.title)}`,'_blank'); }
    const edit = document.createElement('button'); edit.textContent='‚úèÔ∏è'; edit.className='btn-icon'; edit.style.marginLeft='8px'; edit.onclick=()=>openEditor(i);
    right.appendChild(play); right.appendChild(info); right.appendChild(edit);
    item.appendChild(left); item.appendChild(right); p.appendChild(item);
  });
  document.getElementById('playlist-count').textContent = jukebox.playlist.length;
}

/* Play/Pause */
document.getElementById('play-btn').addEventListener('click', ()=>{
  if(!jukebox.playlist.length) return;
  if(!jukebox.isPlaying){ audio.play(); jukebox.isPlaying=true; document.getElementById('play-btn').textContent='‚è∏'; initAudioContext(); } else { audio.pause(); jukebox.isPlaying=false; document.getElementById('play-btn').textContent='‚ñ∂'; }
});
document.getElementById('next-btn').addEventListener('click', ()=>{ if(jukebox.current<jukebox.playlist.length-1) playTrack(jukebox.current+1); });
document.getElementById('prev-btn').addEventListener('click', ()=>{ if(jukebox.current>0) playTrack(jukebox.current-1); });

function playTrack(i){
  const t = jukebox.playlist[i]; if(!t) return;
  jukebox.current = i;
  audio.src = t.url;
  document.getElementById('track-title').textContent = t.title;
  document.getElementById('track-artist').textContent = t.artist || '---';
  document.getElementById('track-album').textContent = t.album || '---';
  if(t.cover) document.getElementById('cover-art').src = t.cover;
  else { showLoader(true); fetchCoverForTrack(t).then(url=>{ if(url) document.getElementById('cover-art').src = url; }).finally(()=>showLoader(false)); }
  audio.play(); jukebox.isPlaying = true; document.getElementById('play-btn').textContent='‚è∏'; initAudioContext();
}

/* progress */
audio.addEventListener('timeupdate', ()=>{ document.getElementById('current-time').textContent = formatTime(audio.currentTime); const p = document.getElementById('progress'); p.max = Math.floor(audio.duration||0); p.value = Math.floor(audio.currentTime||0); document.getElementById('total-time').textContent = formatTime(audio.duration); });
document.getElementById('progress').addEventListener('input', e=> audio.currentTime = Number(e.target.value));

document.getElementById('volume-slider').addEventListener('input', e=>{ audio.volume = e.target.value/100; document.getElementById('volume-display').textContent = e.target.value+'%'; });

function formatTime(t){ if(!t && t!==0) return '0:00'; const m=Math.floor(t/60); const s=Math.floor(t%60); return `${m}:${s.toString().padStart(2,'0')}`; }
function showLoader(v){ document.getElementById('cover-loader').style.display = v? 'flex':'none'; }

/* Cover fetching: iTunes -> MusicBrainz -> placeholder */
async function fetchCoverForTrack(track){
  const key = (track.artist + '|' + track.title).toLowerCase();
  if(jukebox.coverCache[key]) return jukebox.coverCache[key];
  const q = encodeURIComponent((track.artist + ' ' + track.title).trim());
  try{
    const r = await fetch(`https://itunes.apple.com/search?term=${q}&media=music&limit=3`);
    const j = await r.json();
    if(j.results && j.results.length){ const art = j.results[0].artworkUrl100.replace(/100x100bb.jpg$/,'600x600bb.jpg'); const data = await fetchAsDataURL(art); jukebox.coverCache[key]=data; saveCoverCache(); return data; }
  }catch(e){console.warn(e)}
  try{
    const mbq = encodeURIComponent(`recording:"${track.title}" AND artist:"${track.artist}"`);
    const r2 = await fetch(`https://musicbrainz.org/ws/2/recording/?query=${mbq}&fmt=json&limit=3`);
    if(r2.ok){ const j2=await r2.json(); if(j2.recordings && j2.recordings.length){ const rel = j2.recordings[0].releases && j2.recordings[0].releases[0] && j2.recordings[0].releases[0].id; if(rel){ const ca = `https://coverartarchive.org/release/${rel}/front-500.jpg`; const data = await fetchAsDataURL(ca); jukebox.coverCache[key]=data; saveCoverCache(); return data;} } }
  }catch(e){console.warn(e)}
  const placeholder = 'https://placehold.co/600x600/0a0a0a/d4af37?text=‚ô™';
  jukebox.coverCache[key]=placeholder; saveCoverCache(); return placeholder;
}
async function fetchAsDataURL(url){ const r = await fetch(url); if(!r.ok) throw new Error('image'); const b = await r.blob(); return await blobToDataURL(b); }
function blobToDataURL(blob){ return new Promise((res,rej)=>{ const r = new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(blob); }); }

/* === EQ sliders and application === */
const eqSliders = Array.from(document.querySelectorAll('.eq-slider'));
eqSliders.forEach((s, idx)=>{
  s.addEventListener('input', ()=>{ if(jukebox.eqNodes[idx]) jukebox.eqNodes[idx].gain.value = Number(s.value); });
});
document.getElementById('toggle-eq').addEventListener('click', ()=>{ const el = document.getElementById('eq-panel'); el.style.display = (el.style.display==='none' || el.style.display==='')? 'block':'none'; initAudioContext(); });

document.getElementById('bypass-eq').addEventListener('change',(e)=>{
  const bypass = e.target.checked;
  try{
    if(bypass){ jukebox.eqNodes.forEach(n=>n.disconnect()); analyser.connect(audioCtx.destination); }
    else{ analyser.disconnect(); let prev = analyser; jukebox.eqNodes.forEach(n=>{ prev.connect(n); prev = n; }); prev.connect(audioCtx.destination); }
  }catch(e){console.warn(e)}
});

/* === ID3 Editor modal (writes a new blob) === */
function openEditor(index){
  const t = jukebox.playlist[index]; if(!t) return;
  document.getElementById('edit-title').value = t.title || '';
  document.getElementById('edit-artist').value = t.artist || '';
  document.getElementById('edit-album').value = t.album || '';
  document.getElementById('editor-modal').style.display = 'flex';
}
document.getElementById('cancel-edit').addEventListener('click', ()=>document.getElementById('editor-modal').style.display='none');
document.getElementById('save-tags').addEventListener('click', async ()=>{
  const idx = jukebox.current; if(idx<0){ alert('Selecciona la pista primero'); return; }
  const file = jukebox.playlist[idx].fileRef;
  if(!file){ alert('No hay acceso al archivo original'); return; }
  const arr = await file.arrayBuffer(); const writer = new window.ID3Writer(new Uint8Array(arr));
  writer.setFrame('TIT2', document.getElementById('edit-title').value || jukebox.playlist[idx].title);
  writer.setFrame('TPE1', [document.getElementById('edit-artist').value || jukebox.playlist[idx].artist]);
  writer.setFrame('TALB', document.getElementById('edit-album').value || jukebox.playlist[idx].album);
  if(document.getElementById('edit-cover').files && document.getElementById('edit-cover').files[0]){
    const img = await document.getElementById('edit-cover').files[0].arrayBuffer();
    writer.setFrame('APIC', {type:3, data: new Uint8Array(img), description: 'cover'});
  }
  writer.addTag(); const blob = writer.getBlob();
  const newUrl = URL.createObjectURL(blob);
  // replace entry with new blob so user can download
  const idxTrack = jukebox.current;
  jukebox.playlist[idxTrack].url = newUrl;
  jukebox.playlist[idxTrack].fileRef = new File([blob], file.name, {type: file.type});
  renderPlaylist();
  document.getElementById('editor-modal').style.display = 'none';
  alert('Tags escritos en nuevo archivo (desc√°rgalo si deseas).');
});

/* === Spotify PKCE basics (scaffold) === */
const SPOTIFY_CLIENT_ID = ''; // si quieres usar PKCE, pega aqu√≠ client_id y registra redirect URI
function generateRandomString(len){ const chars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'; let s=''; for(let i=0;i<len;i++) s+=chars.charAt(Math.floor(Math.random()*chars.length)); return s; }
async function sha256base64url(str){ const enc = new TextEncoder(); const data = enc.encode(str); const digest = await crypto.subtle.digest('SHA-256', data); const b = btoa(String.fromCharCode(...new Uint8Array(digest))).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,''); return b; }
function startSpotifyAuth(){ if(!SPOTIFY_CLIENT_ID){ alert('Pega SPOTIFY_CLIENT_ID en el c√≥digo para usar PKCE'); return; } const verifier = generateRandomString(128); localStorage.setItem('pkce_verifier', verifier); sha256base64url(verifier).then(challenge=>{ const redirect = location.origin + location.pathname; const url = `https://accounts.spotify.com/authorize?response_type=code&client_id=${encodeURIComponent(SPOTIFY_CLIENT_ID)}&redirect_uri=${encodeURIComponent(redirect)}&code_challenge_method=S256&code_challenge=${encodeURIComponent(challenge)}&scope=`; window.location.href = url; }); }
async function handleSpotifyRedirect(){ const params = new URLSearchParams(location.search); const code = params.get('code'); if(!code) return; const verifier = localStorage.getItem('pkce_verifier'); if(!verifier){ console.warn('no verifier'); return; } try{ const body = new URLSearchParams({grant_type:'authorization_code', code, redirect_uri: location.origin + location.pathname, client_id: SPOTIFY_CLIENT_ID, code_verifier: verifier}); const res = await fetch('https://accounts.spotify.com/api/token',{method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded'}, body}); const j = await res.json(); if(j.access_token){ window.spotifyToken = j.access_token; alert('Spotify autorizado'); history.replaceState({}, '', location.pathname); } }catch(e){console.warn(e)} }
document.getElementById('spotify-info').addEventListener('click', ()=>{
  if(window.spotifyToken) { searchSpotify(true); } else { if(SPOTIFY_CLIENT_ID) startSpotifyAuth(); else searchSpotify(false); }
});
function searchSpotify(auth){
  const t = jukebox.playlist[jukebox.current]; if(!t){ alert('Selecciona pista'); return; }
  const q = encodeURIComponent((t.artist + ' ' + t.title).trim());
  if(auth && window.spotifyToken){
    fetch(`https://api.spotify.com/v1/search?q=${q}&type=track&limit=5`, {headers:{Authorization:'Bearer '+window.spotifyToken}})
      .then(r=>r.json()).then(j=>{ if(j.tracks && j.tracks.items && j.tracks.items.length) window.open(j.tracks.items[0].external_urls.spotify,'_blank'); else window.open(`https://open.spotify.com/search/${q}`,'_blank'); }).catch(()=>window.open(`https://open.spotify.com/search/${q}`,'_blank'));
  } else window.open(`https://open.spotify.com/search/${q}`,'_blank');
}

/* Shazam-like info -> fallback to google */
document.getElementById('shazam-info').addEventListener('click', ()=>{
  const t = jukebox.playlist[jukebox.current]; if(!t){ alert('Selecciona pista'); return; }
  const q = encodeURIComponent((t.artist + ' ' + t.title + ' shazam info').trim());
  window.open(`https://www.google.com/search?q=${q}`,'_blank');
});

/* clear playlist */
document.getElementById('clear-playlist').addEventListener('click', ()=>{ jukebox.playlist.forEach(it=>{ try{ URL.revokeObjectURL(it.url) }catch(e){} }); jukebox.playlist = []; jukebox.current=-1; renderPlaylist(); });

/* initial load cover cache and handle redirect */
handleSpotifyRedirect();

</script>

</body>
</html>
